<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pude≈Çka</title>
    <script>if (typeof module === 'object') {
        window.module = module;
        module = undefined;
    }</script>
    <script src="../../node_modules/jquery/dist/jquery.min.js"></script>
    <script>if (window.module) module = window.module;</script>
    <link href="../../css/main.css" type="text/css" rel="stylesheet"/>
</head>
<body id="fractal_body">
<div id="box-canvas"></div>
<form>
    <div>
        <label for="speedInput">Speed</label>
        <input class="slider" type="range" min="2" max="100" id="speedInput" value="10"/>
    </div>
    <div>
        <label for="lengthInput">Length</label>
        <input class="slider" type="range" min="4" max="100" id="lengthInput" value="10"/>
    </div>
    <div>
        <label for="colorInput">Color</label>
        <input type="color" id="colorInput" value="#ffffff"/>
    </div>
    <div>
        <label for="opacityInput">Intensity: <span id="opacityValue">1</span></label>
        <input class="slider" type="range" min="0.01" max="1" id="opacityInput" value="1" step="0.01"/>
    </div>
    <div>
        <label for="changeColorInput">Change color</label>
        <input type="checkbox" id="changeColorInput"/>
    </div>
    <div>
        <button id="clearButton">Clear</button>
    </div>
    <div>
        <a href="index.html">Menu</a>
    </div>
</form>
</body>
<script>
    jQuery(document).ready(function () {
        let $canvas = $('#box-canvas');
        let graph = [];
        let count = [];
        let graphSize = 5;

        for (let i = 0; i < graphSize; ++i) {
            graph[i] = [];
            count[i] = 0;
            for (let j = 0; j < graphSize; ++j) {
                graph[i][j] = 0;
            }
        }

        graph[0][1] = 1;
        graph[0][2] = 1;
        graph[1][3] = 1;
        graph[3][4] = 1;

        function countDepths() {
            for (let i = 0; i < graphSize; ++i) {
                for (let j = 0; j < graphSize; ++j) {
                    if (graph[i][j] === 1) {
                        count[i] += 1
                    }
                }
            }
        }

        function drawBoxes() {
            countDepths();
            $canvas.append('<div data-number="0" id="box0" class="box" style="width: 100%; height: 100%;"></div>');
            for (let i = 0; i < graphSize; ++i) {
                for (let j = 0; j < graphSize; ++j) {
                    if (graph[i][j] === 1) {
                        $('#box' + i).append('<div data-number="'+j+'" id="box' + j + '" class="box" style="width: ' + 99 / count[i] + '%; height: 80%; background-color: red;"></div>');
                    }
                }
            }

            addNumbers();
            hideAll();
            addClickEvents();
        }

        function addNumbers() {
            for (let i = 0; i < graphSize; ++i) {
                $('#box' + i).prepend('<h1>' + i + '</h1>');
            }
        }

        function hideAll() {
            for (let i = 1; i < graphSize; ++i) {
                $('#box' + i).css('visibility', 'hidden');
            }
        }

        let click = false;

        function addClickEvents() {
            for (let i = 0; i < graphSize; ++i) {
                $('#box' + i).click(function() {
                    let number = parseInt($(this).attr('data-number'));
                    for(let j = 0; j < graphSize; ++j) {
                        if(graph[number][j] === 1) {
                            $('#box' + j).css('visibility', 'visible');
                        }
                    }

                    if(count[number] === 0 && !click) {
                        for(let j = 0; j < graphSize; ++j) {
                            if(graph[j][number] === 1) {
                                count[j]--;
                                break;
                            }
                        }
                        $(this).remove();
                        click = true;

                    } else {
                        click = false;
                    }
                });
            }
        }


        drawBoxes();
    });
</script>
</html>